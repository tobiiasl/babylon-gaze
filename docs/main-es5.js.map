{"version":3,"sources":["webpack:///src/app/engine/engine.component.ts","webpack:///src/app/engine/engine.component.html","webpack:///src/environments/environment.ts","webpack:///src/app/mock/document.mock.ts","webpack:///src/app/mock/window.mock.ts","webpack:///src/app/app.component.ts","webpack:///src/app/app.component.html","webpack:///src/app/mock/storage.mock.ts","webpack:///src/app/gaze.ts","webpack:///src/app/app.module.ts","webpack:///src/app/services/window-ref.service.ts","webpack:///src/app/engine/engine.service.ts","webpack:///src/main.ts","webpack:///$_lazy_route_resource lazy namespace object"],"names":["EngineComponent","engServ","path","window","location","pathname","host","split","pop","length","console","error","log","createScene","rendererCanvas","animate","environment","production","version","DocumentMock","readyState","Document","WindowMock","document","localStorage","sessionStorage","Window","AppComponent","StorageMock","key","index","value","getGaze","ws","WebSocket","gaze$","keepaliveMsg","JSON","stringify","method","id","intervalId","addEventListener","send","body","signalId","clearInterval","msg2","parse","data","setInterval","msg","signal","next","once","pipe","obj","Object","keys","gaze","gaze3d","AppModule","getWindow","WindowRefService","windowObject","EngineService","ngZone","windowRef","canvas","nativeElement","engine","scene","camera","setTarget","Zero","attachControl","light","intensity","eyes1","createEyePair","eyesSetPosition","flyposition","scaleFactor","subscribe","scale","speed","eyesLookAt","eyes","position","origoDistance","Math","abs","left","x","right","leftX","rightX","y","z","point","eyeLookAt","eye","gazeVector","subtract","alpha","atan2","beta","rotation","color","radius","eyeball","CreateSphere","diameter","segments","eyeballmaterial","diffuseColor","White","material","iris","scaling","irismaterial","pupil","pupilmaterial","disableLighting","Black","MergeMeshes","undefined","createEye","distanceBetweenEyes","runOutsideAngular","rendererLoopCallback","render","runRenderLoop","resize","bootstrapModule","err","webpackEmptyAsyncContext","req","Promise","resolve","then","e","Error","code","module","exports"],"mappings":"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","file":"main-es5.js","sourcesContent":["import { Component, ElementRef, OnInit, ViewChild } from '@angular/core';\nimport { ActivatedRoute } from '@angular/router';\nimport {getGaze} from '../gaze';\nimport { EngineService } from './engine.service';\n\n@Component({\n  selector: 'app-engine',\n  templateUrl: './engine.component.html'\n})\nexport class EngineComponent implements OnInit {\n\n  @ViewChild('rendererCanvas', { static: true })\n  public rendererCanvas: ElementRef<HTMLCanvasElement>;\n\n  public constructor(private engServ: EngineService,\n    // private route: ActivatedRoute\n    ) { }\n\n  public ngOnInit(): void {\n    const path = window.location.pathname;\n    const host = path.split('/').pop();\n    if(host.length === 0) {\n      console.error('No RU host name specified. Add e.g. /tg03b-080200100361.local or /192.168.75.51 to the url ');\n    }\n\n    console.log(`Connecting to \"${host}\"`);\n\n    this.engServ.createScene(this.rendererCanvas, host);\n    this.engServ.animate();\n  }\n}\n","<div class=\"engine-wrapper\">\n  <canvas #rendererCanvas id=\"renderCanvas\"></canvas>\n</div>\n","// The file contents for the current environment will overwrite these during build.\n// The build system defaults to the dev environment which uses `environment.ts`, but if you do\n// `ng build --env=prod` then `environment.prod.ts` will be used instead.\n// The list of which env maps to which file can be found in `.angular-cli.json`.\n\nexport const environment = {\n  production: false,\n  version: require('../../package.json').version\n};\n","export class DocumentMock extends Document {\n  public readyState: DocumentReadyState = 'loading';\n}\n","import { DocumentMock } from './document.mock';\nimport { StorageMock } from './storage.mock';\n\nexport class WindowMock extends Window {\n  public document = new DocumentMock();\n  public localStorage = new StorageMock();\n  public sessionStorage = new StorageMock();\n}\n","import { Component } from '@angular/core';\n\n@Component({\n  selector: 'app-root',\n  templateUrl: './app.component.html'\n})\nexport class AppComponent {}\n","<app-engine></app-engine>\n","export class StorageMock implements Storage {\n  public length = 0;\n  public clear(): void { return null; }\n  public getItem(key: string): string { return null; }\n  public key(index: number): string { return null; }\n  public removeItem(key: string): void { return null; }\n  public setItem(key: string, value: string): void { return null; }\n}\n","import {Observable, Subject} from 'rxjs';\nimport {filter, map} from 'rxjs/operators';\n\nexport const getGaze = function(host: string): Observable<any> {\n  const ws = new WebSocket(`ws://${host}/websocket`, 'g3api');\n  const gaze$ = new Subject();\n  const keepaliveMsg = JSON.stringify({method: 'POST', id: 2, path: '//rudimentary!keepalive','body':[]});\n  let intervalId: any;\n  ws.addEventListener('open', () => {\n    ws.send(JSON.stringify({method: 'POST', id: 1, path: '//rudimentary:gaze', body: null}));\n    let signalId: number;\n    ws.addEventListener('close', () => {\n      clearInterval(intervalId);\n    });\n    ws.addEventListener('message', (msg2: MessageEvent<any>) => {\n      signalId = JSON.parse(msg2.data)['body'];\n      intervalId = setInterval(() => ws.send(keepaliveMsg), 3000);\n      ws.addEventListener('message', (msg: MessageEvent<any>) => {\n        const data = JSON.parse(msg.data);\n        if (data.signal === signalId) {\n          gaze$.next(data.body[1]);\n        }\n      });\n    }, {once: true});\n  });\n  return gaze$.pipe(\n    filter((obj) => Object.keys(obj).length > 0),\n    map((gaze: any) => gaze.gaze3d)\n  );\n}\n","import { WindowRefService } from './services/window-ref.service';\nimport { NgModule } from '@angular/core';\nimport { FormsModule } from '@angular/forms';\nimport { BrowserModule } from '@angular/platform-browser';\nimport { AppComponent } from './app.component';\nimport { EngineComponent } from './engine/engine.component';\n\n@NgModule({\n  declarations: [\n    AppComponent,\n    EngineComponent,\n  ],\n  imports: [\n    BrowserModule,\n    FormsModule\n  ],\n  providers: [\n    WindowRefService\n  ],\n  bootstrap: [\n    AppComponent\n  ]\n})\nexport class AppModule { }\n","import { Injectable } from '@angular/core';\nimport { WindowMock } from '../mock/window.mock';\n\nconst getWindow = (): Window => window != null ? window : new WindowMock();\n\n@Injectable()\nexport class WindowRefService {\n  private readonly windowObject: Window;\n\n  public constructor() {\n    this.windowObject = getWindow();\n  }\n\n  public get window(): Window {\n    return this.windowObject;\n  }\n\n  public get document(): Document {\n    return this.window.document;\n  }\n\n  public get localStore(): Storage {\n    return this.window.localStorage;\n  }\n\n  public get sessionStorage(): Storage {\n    return this.window.sessionStorage;\n  }\n}\n","import { WindowRefService } from './../services/window-ref.service';\nimport {ElementRef, Injectable, NgZone} from '@angular/core';\nimport {\n  Engine,\n  FreeCamera,\n  Scene,\n  Light,\n  Mesh,\n  MeshBuilder,\n  Color3,\n  Vector3,\n  HemisphericLight,\n  StandardMaterial,\n  DynamicTexture,\n} from '@babylonjs/core';\nimport {getGaze} from '../gaze';\n\ninterface EyePair {\n  left: Mesh;\n  right: Mesh;\n}\n@Injectable({ providedIn: 'root' })\nexport class EngineService {\n  private canvas: HTMLCanvasElement;\n  private engine: Engine;\n  private camera: FreeCamera;\n  private scene: Scene;\n  private light: Light;\n\n  private sphere: Mesh;\n\n  public constructor(\n    private ngZone: NgZone,\n    private windowRef: WindowRefService\n  ) {}\n\n\n  public createScene(canvas: ElementRef<HTMLCanvasElement>, host: string): void {\n    // The first step is to get the reference of the canvas element    from our HTML document\n    this.canvas = canvas.nativeElement;\n\n    // Then, load the Babylon 3D engine:\n    this.engine = new Engine(this.canvas,  true);\n\n    // This creates a basic Babylon Scene object (non-mesh)\n    this.scene = new Scene(this.engine);\n\n    // This creates and positions a free camera (non-mesh)\n    this.camera = new FreeCamera(\"camera1\", new Vector3(0, 0, -20), this.scene);\n\n    // This targets the camera to scene origin\n    this.camera.setTarget(Vector3.Zero());\n\n    // This attaches the camera to the canvas\n    this.camera.attachControl(canvas, true);\n\n    // This creates a light, aiming 0,1,0 - to the sky (non-mesh)\n    var light = new HemisphericLight(\"light1\", new Vector3(-1, 1, -1), this.scene);\n\n    // Default intensity is 1. Let's dim the light a small amount\n    light.intensity = 1;\n\n    var eyes1 = this.createEyePair(new Color3(0, 0.85, 1), this.scene);\n\n    this.eyesSetPosition(eyes1, new Vector3(0, 0, 0));\n\n    let flyposition = new Vector3(0, 0, -10);\n\n    const scaleFactor = 1.7 / 59;\n\n    host = 'tg03b-080200100361.local'\n    getGaze(host).subscribe(\n      (gaze: any) => {\n        flyposition = new Vector3(gaze[0], gaze[1], -gaze[2]).scale(scaleFactor);\n      }\n    );\n\n    var index = 0;\n    setInterval(() => {\n      index++;\n      var speed = 0.3;\n      this.eyesLookAt(eyes1, flyposition);\n    }, 1000/60);\n  }\n\n  public eyesSetPosition(eyes: EyePair, position: Vector3) {\n      var origoDistance = Math.abs(eyes.left.position.x - eyes.right.position.x);\n      var leftX = position.x - origoDistance / 2;\n      var rightX = position.x + origoDistance / 2;\n\n      eyes.left.position = new Vector3(leftX, position.y, position.z);\n      eyes.right.position = new Vector3(rightX, position.y, position.z);\n  }\n\n  public eyesLookAt(eyes: EyePair, point: Vector3) {\n      this.eyeLookAt(eyes.left, point);\n      this.eyeLookAt(eyes.right, point);\n  }\n\n  public eyeLookAt(eye: Mesh, point: Vector3) {\n      var gazeVector = point.subtract(eye.position);\n      var alpha = Math.atan2(gazeVector.y, -gazeVector.z);\n      var beta = Math.atan2(gazeVector.x, -gazeVector.z);\n\n      eye.rotation = new Vector3(alpha, -beta);\n  }\n\n  public createEye(color: Color3, radius: number, scene: Scene): Mesh {\n      var eyeball = MeshBuilder.CreateSphere(\"eyeball\", {diameter: 2 * radius, segments: 16}, scene);\n\n      // const eyeballmaterial = new CellMaterial(\"eyeballmaterial\", scene);\n      const eyeballmaterial = new StandardMaterial(\"eyeballmaterial\", scene);\n      eyeballmaterial.diffuseColor = Color3.White();\n      eyeball.material = eyeballmaterial;\n\n      var iris = MeshBuilder.CreateSphere(\"pupil\", {diameter: 2* 0.4 * radius, segments: 8}, scene);\n      iris.position.z = -radius*.97;\n      iris.scaling.z = 0.05;  // Make it flat\n\n      const irismaterial = new StandardMaterial(\"irismaterial\", scene);\n      irismaterial.diffuseColor = color;\n      iris.material = irismaterial;\n\n      var pupil = MeshBuilder.CreateSphere(\"pupil\", {diameter: 2* 0.2 * radius, segments: 16}, scene);\n      pupil.position.z = -radius*1;\n      pupil.scaling.z = 0.1;  // Make it flat\n\n      const pupilmaterial = new StandardMaterial(\"pupilmaterial\", scene);\n      pupilmaterial.disableLighting = true;\n      pupilmaterial.diffuseColor = Color3.Black();\n      pupil.material = pupilmaterial;\n\n      var eye = Mesh.MergeMeshes([eyeball, iris, pupil], true, true, undefined, false, true);\n      return eye;\n  }\n\n  public createEyePair(color: Color3, scene: Scene) : EyePair {\n      var radius = 1;\n      var left = this.createEye(color, radius, scene);\n      var right = this.createEye(color, radius, scene);\n\n      var distanceBetweenEyes = 1.7 * radius;\n      left.position.x = -distanceBetweenEyes;\n      right.position.x = distanceBetweenEyes;\n\n      return {left, right};\n  }\n\n  public animate(): void {\n    // We have to run this outside angular zones,\n    // because it could trigger heavy changeDetection cycles.\n    this.ngZone.runOutsideAngular(() => {\n      const rendererLoopCallback = () => {\n        this.scene.render();\n      };\n\n      if (this.windowRef.document.readyState !== 'loading') {\n        this.engine.runRenderLoop(rendererLoopCallback);\n      } else {\n        this.windowRef.window.addEventListener('DOMContentLoaded', () => {\n          this.engine.runRenderLoop(rendererLoopCallback);\n        });\n      }\n\n      this.windowRef.window.addEventListener('resize', () => {\n        this.engine.resize();\n      });\n    });\n  }\n\n}\n","import { enableProdMode } from '@angular/core';\nimport { platformBrowserDynamic } from '@angular/platform-browser-dynamic';\n\nimport { AppModule } from './app/app.module';\nimport { environment } from './environments/environment';\n\nif (environment.production) {\n  enableProdMode();\n}\n\nplatformBrowserDynamic().bootstrapModule(AppModule)\n  .catch(err => console.error(err));\n","function webpackEmptyAsyncContext(req) {\n\t// Here Promise.resolve().then() is used instead of new Promise() to prevent\n\t// uncaught exception popping up in devtools\n\treturn Promise.resolve().then(function() {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t});\n}\nwebpackEmptyAsyncContext.keys = function() { return []; };\nwebpackEmptyAsyncContext.resolve = webpackEmptyAsyncContext;\nmodule.exports = webpackEmptyAsyncContext;\nwebpackEmptyAsyncContext.id = \"zn8P\";"]}